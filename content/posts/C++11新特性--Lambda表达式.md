---
date: 2025-05-14T11:00:59+08:00
title: C++11æ–°ç‰¹æ€§--Lambdaè¡¨è¾¾å¼
description: C++11æ–°ç‰¹æ€§--Lambdaè¡¨è¾¾å¼
featured_image: /images/book.png
images:
  - /images/book.png
tags:
  - tutorial
  - cpp11
categories: Tutorials
---
# åŸºæœ¬ä»‹ç»

C++11 å¼•å…¥äº† **Lambda è¡¨è¾¾å¼ï¼ˆLambda Expressionï¼‰**ï¼Œå®ƒæ˜¯ä¸€ç§ç”¨äºå®šä¹‰ **åŒ¿åå‡½æ•°å¯¹è±¡** çš„è¯­æ³•ã€‚Lambda è¡¨è¾¾å¼è®©æˆ‘ä»¬å¯ä»¥æ›´æ–¹ä¾¿åœ°ç¼–å†™å†…è”å‡½æ•°ï¼Œå°¤å…¶æ˜¯åœ¨éœ€è¦ä¸´æ—¶å‡½æ•°è¡Œä¸ºçš„åœºæ™¯ï¼Œæ¯”å¦‚ `std::sort()`ã€`std::for_each()`ã€å›è°ƒå‡½æ•°ç­‰ã€‚

## ä¸€ã€åŸºæœ¬è¯­æ³•

```cpp
[capture](parameters) -> return_type {
    function_body
};
```

å„éƒ¨åˆ†å«ä¹‰å¦‚ä¸‹ï¼š

| éƒ¨åˆ† | å«ä¹‰ |
| ---- | ---- |
| [capture] | æ•è·å¤–éƒ¨å˜é‡çš„æ–¹å¼ï¼ˆå€¼æ•è·ã€å¼•ç”¨æ•è·ç­‰ï¼‰ |
| (params) | å‚æ•°åˆ—è¡¨ï¼ˆç±»ä¼¼æ™®é€šå‡½æ•°ï¼‰ |
| -> type | è¿”å›ç±»å‹ï¼ˆå¯çœç•¥ï¼Œç¼–è¯‘å™¨ä¼šæ¨å¯¼ï¼‰ |
| { body } | å‡½æ•°ä½“ |

## äºŒã€åŸºæœ¬ç¤ºä¾‹


```cpp
#include 
int main() {
    auto add = [](int a, int b) {
        return a + b;
    };
    std::cout << add(2, 3) << std::endl;  // è¾“å‡º 5
}
```


## ä¸‰ã€æ•è·å˜é‡ï¼ˆcaptureï¼‰

æ•è·åˆ—è¡¨ `[ ]` æŒ‡å®šäº† Lambda å¯ä»¥ä½¿ç”¨çš„å¤–éƒ¨å˜é‡ï¼Œæœ‰ä»¥ä¸‹æ–¹å¼ï¼š

### 1. å€¼æ•è·ï¼ˆby valueï¼‰

```cpp
int x = 10;
auto f = [x]() {
    std::cout << x << std::endl;  // æ‹·è´ x
};
```

### 2. å¼•ç”¨æ•è·ï¼ˆby referenceï¼‰

```cpp
int x = 10;
auto f = [&x]() {
    x += 1;
};
```

### 3. æ··åˆæ•è·

```cpp
int a = 1, b = 2;
auto f = [a, &b]() {
    // a æ˜¯å€¼æ•è·ï¼Œb æ˜¯å¼•ç”¨æ•è·
};
```

### 4. éšå¼æ•è·

- `[=]`ï¼šæ‰€æœ‰ä½¿ç”¨çš„å¤–éƒ¨å˜é‡æŒ‰ **å€¼** æ•è·
- `[&]`ï¼šæ‰€æœ‰ä½¿ç”¨çš„å¤–éƒ¨å˜é‡æŒ‰ **å¼•ç”¨** æ•è·

## å››ã€è¿”å›ç±»å‹

å¦‚æœè¿”å›å€¼å¤æ‚æˆ–ä¸æ˜“æ¨å¯¼ï¼Œå¯ä»¥ä½¿ç”¨ `-> return_type` æŒ‡å®šï¼š

```cpp
auto f = [](int a, int b) -> double {
    return a / (double)b;
};
```

## äº”ã€å¯å˜ Lambdaï¼ˆmutableï¼‰

é»˜è®¤æƒ…å†µä¸‹ï¼Œå€¼æ•è·çš„å˜é‡åœ¨ Lambda å†…éƒ¨æ˜¯ `const` çš„ã€‚å¦‚æœæƒ³ä¿®æ”¹è¿™äº›å€¼ï¼Œå¯ä»¥ä½¿ç”¨ `mutable`ï¼š

```cpp
int x = 10;
auto f = [x]() mutable {
    x += 5;
    std::cout << x << std::endl;  // è¾“å‡º 15
};
f();
std::cout << x << std::endl;  // è¾“å‡º 10ï¼Œå¤–éƒ¨ä¸å˜
```


## å…­ã€Lambda ä¸æ ‡å‡†ç®—æ³•ç»“åˆ


```cpp
#include 
#include 

std::vector v = {1, 2, 3, 4, 5};
std::for_each(v.begin(), v.end(), [](int x) {
    std::cout << x << " ";
});
```



## ä¸ƒã€Lambda çš„ç±»å‹å’Œ std::function


Lambda æ˜¯ç¼–è¯‘å™¨ç”Ÿæˆçš„åŒ¿åç±»ï¼Œå¯ä»¥èµ‹å€¼ç»™ `std::function`ï¼š


```cpp
#include 

std::function f = [](int a, int b) {
    return a + b;
};
```



## æ€»ç»“ï¼šLambda çš„å¼ºå¤§ä¹‹å¤„


- **å†…è”å®šä¹‰å‡½æ•°é€»è¾‘**ï¼Œé¿å…å†—ä½™å‡½æ•°å®šä¹‰
- **æ–¹ä¾¿ä¸ STL é…åˆ**
- æ”¯æŒ **å€¼/å¼•ç”¨æ•è·**ï¼Œçµæ´»æ€§å¼º
- å®ç°ç®€å•çš„ **å›è°ƒå‡½æ•°** æˆ–äº‹ä»¶å¤„ç†é€»è¾‘

å¦‚æœä½ æœ‰å…·ä½“åœºæ™¯æˆ–è€…æƒ³ç»“åˆ STL ç®—æ³•æ·±å…¥äº†è§£ï¼Œæˆ‘å¯ä»¥ç»™ä½ ä¸¾å‡ ä¸ªå®ç”¨çš„ä¾‹å­ã€‚æ˜¯å¦éœ€è¦ï¼Ÿ

# å®é™…ä¾‹å­

## ä¸€ã€ç»“åˆæ ‡å‡†ç®—æ³•çš„å®ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šstd::sort è‡ªå®šä¹‰æ’åº


```cpp
#include 
#include 
#include 

int main() {
    std::vector v = {5, 1, 3, 4, 2};

    // æŒ‰é™åºæ’åº
    std::sort(v.begin(), v.end(), [](int a, int b) {
        return a &gt; b;
    });

    for (int x : v) std::cout << x << " ";  // è¾“å‡ºï¼š5 4 3 2 1
}
```

### ç¤ºä¾‹2ï¼šstd::find_if æŸ¥æ‰¾ç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„å…ƒç´ 


```cpp
#include 
#include 
#include 

int main() {
    std::vector v = {1, 3, 5, 8, 10};

    auto it = std::find_if(v.begin(), v.end(), [](int x) {
        return x % 2 == 0;
    });

    if (it != v.end()) std::cout << "æ‰¾åˆ°å¶æ•°ï¼š" << *it << std::endl;  // è¾“å‡º 8
}
```

### ç¤ºä¾‹3ï¼šstd::count_if ç»Ÿè®¡æ»¡è¶³æ¡ä»¶çš„ä¸ªæ•°


```cpp
#include 
#include 
#include 

int main() {
    std::vector v = {1, 4, 6, 9, 10};

    int count = std::count_if(v.begin(), v.end(), [](int x) {
        return x &gt; 5;
    });

    std::cout << "å¤§äº5çš„å…ƒç´ ä¸ªæ•°ï¼š" << count << std::endl;  // è¾“å‡º 3
}
```

### ç¤ºä¾‹4ï¼šä¼ é€’çŠ¶æ€çš„ Lambdaï¼ˆé€šè¿‡æ•è·å˜é‡ï¼‰


```cpp
#include 
#include 
#include 

int main() {
    std::vector v = {1, 2, 3, 4, 5};
    int threshold = 3;

    std::vector filtered;
    std::copy_if(v.begin(), v.end(), std::back_inserter(filtered), [threshold](int x) {
        return x &gt; threshold;
    });

    for (int x : filtered) std::cout << x << " ";  // è¾“å‡º 4 5
}
```

## äºŒã€Lambda è¡¨è¾¾å¼çš„åº•å±‚æœ¬è´¨ï¼ˆç¼–è¯‘å™¨å®ç°æ–¹å¼ï¼‰


Lambda æ˜¯ä¸€ç§ **åŒ¿åå‡½æ•°å¯¹è±¡**ã€‚æœ¬è´¨ä¸Šï¼Œç¼–è¯‘å™¨ä¼šä¸ºæ¯ä¸ª Lambda ç”Ÿæˆä¸€ä¸ªåŒ¿åçš„ç±»å¹¶é‡è½½ `operator()`ï¼Œä¾‹å¦‚ï¼š

```cpp
auto f = [](int x) { return x + 1; };
```

ç­‰ä»·äºï¼š

```cpp
struct Lambda {
    int operator()(int x) const {
        return x + 1;
    }
};

Lambda f;
```

å¦‚æœ Lambda æ•è·äº†å˜é‡ï¼Œç¼–è¯‘å™¨ä¼šå°†è¿™äº›å˜é‡å­˜å‚¨ä¸ºç±»çš„æˆå‘˜å˜é‡ã€‚

## ä¸‰ã€lambda ä¸ std::function çš„æ¯”è¾ƒ

- `auto f = [](int x) { return x + 1; };` â€”â€” è¿™æ—¶å€™ `f` çš„ç±»å‹æ˜¯ä¸€ä¸ªç¼–è¯‘å™¨ç”Ÿæˆçš„ç±»ï¼Œä¸èƒ½ç›´æ¥å†™å‡ºç±»å‹åã€‚
- å¦‚æœä½ éœ€è¦æŠŠ lambda å­˜å…¥å®¹å™¨æˆ–ä¼ é€’ç»™å‡½æ•°ï¼Œä½ é€šå¸¸ç”¨ `std::function`ï¼š

```cpp
#include 

std::function func = [](int x) { return x + 1; };
```

æ³¨æ„ï¼š`std::function` æ˜¯æœ‰å¼€é”€çš„ï¼ˆç±»å‹æ“¦é™¤ã€å †åˆ†é…ç­‰ï¼‰ï¼Œå¦‚æœèƒ½ä½¿ç”¨ `auto`ï¼Œé€šå¸¸æ€§èƒ½æ›´å¥½ã€‚

## å››ã€å¯é€’å½’ Lambda

C++11 ä¸æ”¯æŒ lambda è‡ªå¼•ç”¨è‡ªå·±çš„åå­—ï¼ˆå› ä¸ºæ²¡æœ‰åå­—ï¼‰ï¼Œä¸è¿‡æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `std::function` æ¥é€’å½’ï¼š

```cpp
#include 
#include 

int main() {
    std::function fib = [&](int n) -> int {
        if (n <= 1) return n;
        return fib(n - 1) + fib(n - 2);
    };

    std::cout << fib(10) << std::endl;  // è¾“å‡º 55
}
```

## äº”ã€æ€»ç»“è¦ç‚¹

| ç‰¹æ€§ | æè¿° |
| ---- | ---- |
| [] æ•è·åˆ—è¡¨ | æ•è·å¤–éƒ¨å˜é‡ï¼ˆå€¼/å¼•ç”¨ï¼‰ |
| mutable | ä¿®æ”¹æ•è·çš„å€¼å˜é‡å‰¯æœ¬ |
| -> return_type | æ˜ç¡®è¿”å›ç±»å‹ |
| å¯ä¸ STL é…åˆ | sortã€find_ifã€count_if ç­‰æ›´æ¸…æ™° |
| ç±»å‹ä¸ºåŒ¿åç±» | å®ç° operator() çš„é—­åŒ… |
| ä¸ std::function é…åˆ | æ”¯æŒé€’å½’ã€ç±»å‹æ“¦é™¤ï¼ˆä½†ç•¥æœ‰æ€§èƒ½å¼€é”€ï¼‰ |

#  C++14/C++17 ä¸­ Lambda çš„æ‰©å±•

C++14 å’Œ C++17 å¯¹ Lambda è¡¨è¾¾å¼è¿›è¡Œäº†éå¸¸å®ç”¨çš„å¢å¼ºï¼Œå°¤å…¶æ˜¯ **æ³›å‹ Lambda** å’Œ **æ›´çµæ´»çš„æ•è·æ–¹å¼**ã€‚

## âœ… ä¸€ã€C++14ï¼šLambda è¡¨è¾¾å¼çš„å¢å¼º

### 1. æ³›å‹ Lambdaï¼ˆGeneric Lambdaï¼‰

C++14 å…è®¸ä½ åœ¨ Lambda çš„å‚æ•°åˆ—è¡¨ä¸­ä½¿ç”¨ `auto`ï¼Œè¡¨ç¤ºå‚æ•°ç±»å‹è‡ªåŠ¨æ¨å¯¼ â€”â€” è¿™å°±ä½¿å¾— Lambda æœ¬èº«å˜æˆæ¨¡æ¿å‡½æ•°çš„æ„Ÿè§‰ã€‚
#### âœ… ç¤ºä¾‹ï¼š

```cpp
auto add = [](auto a, auto b) {
    return a + b;
};

std::cout << add(1, 2) << std::endl;         // è¾“å‡º 3ï¼ˆintï¼‰
std::cout << add(1.5, 2.5) << std::endl;     // è¾“å‡º 4.0ï¼ˆdoubleï¼‰
std::cout << add(std::string("a"), "b") << std::endl; // è¾“å‡º ab
```
### âœ… èƒŒååŸç†ï¼š

æ³›å‹ Lambda ç¼–è¯‘å™¨å®ç°å…¶å®å°±æ˜¯è‡ªåŠ¨ä¸ºæ¯ä¸ªè°ƒç”¨ç”Ÿæˆä¸€ä¸ªæ¨¡æ¿çš„ `operator()`ã€‚

### 2. åˆå§‹åŒ–æ•è·ï¼ˆInit-captureï¼‰

C++14 å¼•å…¥äº†ä¸€ç§ **æŒ‰å€¼åˆå§‹åŒ–å±€éƒ¨å˜é‡** å¹¶æ•è·çš„æ–¹å¼ï¼Œè¯­æ³•æ˜¯ï¼š

```cpp
[variable_name = expression]
```
#### âœ… ç¤ºä¾‹ï¼š

```cpp
int x = 10;

auto f = [y = x + 5]() {
    std::cout << y << std::endl;  // è¾“å‡º 15
};
f();
```

è¿™ç§æ•è·æ–¹å¼éå¸¸é€‚åˆå°†å¤æ‚è¡¨è¾¾å¼çš„ç»“æœæ•è·è¿› Lambdaï¼Œ**è€Œä¸æ˜¯æ•è·å˜é‡æœ¬èº«å†åœ¨ Lambda ä¸­æ±‚å€¼**ã€‚


## âœ… äºŒã€C++17ï¼šLambda è¡¨è¾¾å¼çš„å¢å¼º

### 1. é»˜è®¤æ•è·ä¸æ˜¾å¼æ··åˆæ•è·

åœ¨ C++11 ä¸­ï¼Œä¸èƒ½åŒæ—¶ä½¿ç”¨ `[=]` å’Œ `&x`ï¼›è€Œåœ¨ **C++17 ä¸­ï¼Œå…è®¸ç»„åˆé»˜è®¤æ•è·å’Œæ˜¾å¼æ•è·**ï¼š
#### âœ… ç¤ºä¾‹ï¼š

```cpp
int a = 1, b = 2;

auto f = [=, &b]() {
    // a è¢«å€¼æ•è·ï¼Œb è¢«å¼•ç”¨æ•è·
    std::cout << a << " " << ++b << std::endl;
};
f();  // è¾“å‡ºï¼š1 3ï¼ˆb ä¿®æ”¹äº†ï¼‰
```

åŒæ ·ä¹Ÿå¯ä»¥åè¿‡æ¥ `[&, x]` è¡¨ç¤ºé»˜è®¤å¼•ç”¨æ•è·ï¼Œä½† x å€¼æ•è·ã€‚

### 2. æ•è· this æŒ‡é’ˆçš„æˆå‘˜å˜é‡ï¼ˆC++17ï¼‰

C++11 åªèƒ½æ•è· `this` æŒ‡é’ˆï¼Œç„¶ååœ¨ lambda ä¸­è®¿é—® `this->member`ã€‚
C++17 æ”¯æŒ **å€¼æ•è·æˆå‘˜å˜é‡** â€”â€” å¦‚æœç”¨ `[=]` æ•è·ï¼Œå°±ç›¸å½“äºæŒ‰å€¼æ‹·è´ `this` æ‰€æŒ‡å¯¹è±¡çš„æˆå‘˜ï¼š

```cpp
struct MyClass {
    int x = 42;

    void print() {
        auto f = [=]() {
            std::cout << x << std::endl;  // ç›¸å½“äº this->x
        };
        f();
    }
};
```

æ³¨æ„ï¼šå®é™…ä¸Š `[=]` æ•è·çš„æ˜¯ `this`ï¼Œåªæ˜¯ C++17 åœ¨è¯­ä¹‰ä¸Šç®€åŒ–äº†è®¿é—®æ–¹å¼ã€‚

### 3. Lambda å¯ä»¥æ˜¯ constexpr

C++17 å¼€å§‹å…è®¸ Lambda æˆä¸º `constexpr`ï¼Œå³å¯ä»¥åœ¨ç¼–è¯‘æœŸè°ƒç”¨ã€‚
#### âœ… ç¤ºä¾‹ï¼š

```cpp
constexpr auto square = [](int x) {
    return x * x;
};

constexpr int y = square(5);  // ç¼–è¯‘æœŸè®¡ç®— y = 25
```

## âœ… æ€»ç»“


| ç‰¹æ€§ | C++14 / C++17 çŠ¶æ€ | ç¤ºä¾‹ |
| ---- | ---- | ---- |
| æ³›å‹ Lambda | âœ… C++14 | [](auto a, auto b){...} |
| åˆå§‹åŒ–æ•è· | âœ… C++14 | [val = expr] |
| æ··åˆæ•è·ï¼ˆé»˜è®¤+æ˜¾å¼ï¼‰ | âœ… C++17 | [=, &x] æˆ– [&, x] |
| ç®€åŒ– this æ•è· | âœ… C++17 | [=] å¯ç›´æ¥è®¿é—®æˆå‘˜å˜é‡ |
| constexpr Lambda | âœ… C++17 | constexpr auto f = ...; |

# åº•å±‚ç¼–è¯‘å™¨å¦‚ä½•ç”Ÿæˆ Lambda çš„ç±»ç»“æ„


## âœ… Lambda çš„æœ¬è´¨

Lambda è¡¨è¾¾å¼åœ¨ç¼–è¯‘å™¨çœ¼ä¸­æ˜¯ä¸€ä¸ª **åŒ¿åç±»ï¼ˆclosure classï¼‰** çš„å®ä¾‹ï¼Œå®ƒ **é‡è½½äº† operator()**ã€‚å¦‚æœä½ å†™äº†ä¸€ä¸ª Lambdaï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨å¸®ä½ ç”Ÿæˆä¸€ä¸ªç±»ä¼¼ä¸‹é¢ç»“æ„çš„ç±»ã€‚

## ğŸ”§ ç¤ºä¾‹ 1ï¼šæ— æ•è· Lambda

```cpp
auto f = [](int x) { return x + 1; };
```

ç­‰ä»·äºï¼ˆä¼ªä»£ç ï¼‰ï¼š

```cpp
struct __Lambda_1 {
    int operator()(int x) const {
        return x + 1;
    }
};

__Lambda_1 f;
```


æ— æ•è·çš„ Lambda å¯ä»¥ **éšå¼è½¬æ¢ä¸ºå‡½æ•°æŒ‡é’ˆ**ï¼š

```cpp
int (*fp)(int) = [](int x) { return x + 1; };
```


## ğŸ”§ ç¤ºä¾‹ 2ï¼šæœ‰æ•è·å˜é‡çš„ Lambda


```cpp
int a = 10;
auto f = [a](int x) { return x + a; };
```

ç¼–è¯‘å™¨ç­‰ä»·äºï¼š

```cpp
struct __Lambda_2 {
    int a;  // æ•è·çš„å˜é‡æˆä¸ºæˆå‘˜

    __Lambda_2(int _a) : a(_a) {}

    int operator()(int x) const {
        return x + a;
    }
};

__Lambda_2 f(a);
```

âœ… æ³¨æ„ï¼š
- æ•è·çš„å˜é‡ä½œä¸ºç±»æˆå‘˜å­˜å‚¨ï¼›
- `operator()` é»˜è®¤ä¸º `const` æˆå‘˜å‡½æ•°ï¼›
- `mutable` ä¼šç§»é™¤è¿™ä¸ª `const` ä¿®é¥°ã€‚

## ğŸ”§ ç¤ºä¾‹ 3ï¼šå¼•ç”¨æ•è·

```cpp
int a = 10;
auto f = [&a](int x) { a += x; };
```

ç¼–è¯‘å™¨ç­‰ä»·äºï¼š

```cpp
struct __Lambda_3 {
    int& a;

    __Lambda_3(int& _a) : a(_a) {}

    void operator()(int x) const {
        a += x;
    }
};

__Lambda_3 f(a);
```

## ğŸ”§ ç¤ºä¾‹ 4ï¼šmutable Lambdaï¼ˆå€¼æ•è·ä½†å…è®¸ä¿®æ”¹å‰¯æœ¬ï¼‰


```cpp
int a = 10;
auto f = [a]() mutable { a += 1; std::cout << a; };
```

ç¼–è¯‘å™¨ç”Ÿæˆçš„ä¼ªä»£ç ï¼š

```cpp
struct __Lambda_4 {
    int a;

    __Lambda_4(int _a) : a(_a) {}

    void operator()() {
        a += 1;
        std::cout << a;
    }
};
```

æ³¨æ„ `operator()` ä¸å†æ˜¯ `const`ï¼Œå› ä¸ºéœ€è¦ä¿®æ”¹æˆå‘˜ `a`ã€‚


## âœ… å®é™…è§‚å¯Ÿ Lambda ç±»ï¼šä½¿ç”¨ clang++ -Xclang -ast-dump æˆ– MSVC /d1reportAllClassLayout

åœ¨å®é™…é¡¹ç›®ä¸­ä½ å¯ä»¥ç”¨ `clang` æˆ– MSVC å·¥å…·æŸ¥çœ‹ Lambda å¯¹è±¡çš„å®é™…ç±»ç»“æ„ã€‚æ¯”å¦‚ï¼š


```sh
clang++ -std=c++14 -Xclang -ast-dump -fsyntax-only lambda.cpp
```


å¯ä»¥çœ‹åˆ° Lambda è½¬æ¢æˆäº†å…·ä½“ç±»ç»“æ„ï¼Œç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆäº†ï¼š

- æ•°æ®æˆå‘˜ï¼ˆæ•è·å˜é‡ï¼‰
- `operator()`
- æ„é€ å‡½æ•°ï¼ˆåˆå§‹åŒ–æ•è·æˆå‘˜ï¼‰
- `operator==`ï¼ˆC++20 èµ·æ”¯æŒæ¯”è¾ƒï¼‰
- å¯èƒ½çš„ `constexpr` æˆ– `noexcept` å±æ€§


## âœ… ç‰¹æ®Šæƒ…å†µï¼šæ³›å‹ Lambdaï¼ˆC++14+ï¼‰


```cpp
auto f = [](auto x) { return x * x; };
```

ç­‰ä»·äºä¸€ä¸ª **ç±»æ¨¡æ¿çš„ operator()**ï¼š

```cpp
struct __Lambda {
    template
    auto operator()(T x) const {
        return x * x;
    }
};
```

è¿™æ˜¯ C++14 çš„ä¸€å¤§å¢å¼ºï¼šLambda è‡ªå¸¦æ¨¡æ¿æœºåˆ¶ã€‚

## âœ… æ€»ç»“

| ç‰¹æ€§ | åº•å±‚å®ç° |
| ---- | ---- |
| æ— æ•è· Lambda | ç±»ä¸­æ— æˆå‘˜ï¼Œæ”¯æŒå‡½æ•°æŒ‡é’ˆè½¬æ¢ |
| å€¼æ•è· | æ•è·å˜é‡æ˜¯ç±»æˆå‘˜ |
| å¼•ç”¨æ•è· | æˆå‘˜æ˜¯å¼•ç”¨ç±»å‹ |
| mutable | operator() å»æ‰ const |
| æ³›å‹ Lambda | operator() æ˜¯æ¨¡æ¿å‡½æ•° |
 **Lambda æœ¬è´¨å°±æ˜¯å¸¦çŠ¶æ€çš„å‡½æ•°å¯¹è±¡**ã€‚
 
# æ‰‹åŠ¨æ¨¡æ‹Ÿä¸€ä¸ª Lambda çš„åº•å±‚ç»“æ„

**äº²æ‰‹å®ç°ä¸€ä¸ªç±»**ï¼ŒåŠŸèƒ½å’Œä¸‹é¢çš„ Lambda å®Œå…¨ç­‰ä»·ï¼š

```cpp
int a = 10;
int b = 20;
auto lambda = [a, &b](int x) {
    return a + b + x;
};
```

## ğŸ¯ ç›®æ ‡ï¼šè‡ªå·±å®ç°ç­‰ä»·çš„ç±»ç»“æ„

### Lambda ç­‰ä»·äºè¿™æ ·çš„è°ƒç”¨æ–¹å¼ï¼š

```cpp
int result = lambda(5);  // è¿”å› a + b + x = 10 + 20 + 5 = 35
```

## ğŸ›  æ‰‹åŠ¨å®ç°

æˆ‘ä»¬æ¥ä¸€æ­¥æ­¥å†™å‡ºå®ƒå¯¹åº”çš„ç±»ç»“æ„ï¼š

```cpp
#include 

struct MyLambda {
    int a;    // å€¼æ•è·çš„ a
    int& b;   // å¼•ç”¨æ•è·çš„ b

    // æ„é€ å‡½æ•°ï¼šæ¨¡æ‹Ÿæ•è·
    MyLambda(int a_, int& b_) : a(a_), b(b_) {}

    // operator() æ¨¡æ‹Ÿ lambda çš„è°ƒç”¨
    int operator()(int x) const {
        return a + b + x;
    }
};

int main() {
    int a = 10;
    int b = 20;

    MyLambda lambda(a, b);  // æ¨¡æ‹Ÿæ•è·
    std::cout << lambda(5) << std::endl;  // è¾“å‡º 35
}
```

## âœ… åˆ†æ

| éƒ¨åˆ† | å®ç°é€»è¾‘ |
| ---- | ---- |
| int a | æ¨¡æ‹Ÿå€¼æ•è· |
| int& b | æ¨¡æ‹Ÿå¼•ç”¨æ•è· |
| æ„é€ å‡½æ•° | åˆå§‹åŒ–æ•è·å˜é‡ |
| operator() | æ¨¡æ‹Ÿå‡½æ•°è°ƒç”¨è¯­æ³• lambda(x) |
| const ä¿®é¥° | è¡¨ç¤ºå‡½æ•°ä¸ä¼šä¿®æ”¹ a å’Œ b çš„å€¼ |

## ğŸ”„ åŠ ä¸Š mutable çš„å˜ä½“

Lambdaï¼š

```cpp
auto lambda = [a]() mutable {
    a += 1;
    std::cout << a;
};
```

ç­‰ä»·ç±»ï¼š

```cpp
struct MutableLambda {
    int a;

    MutableLambda(int a_) : a(a_) {}

    void operator()() {
        a += 1;
        std::cout << a << std::endl;
    }
};
```

æ³¨æ„ï¼š**æ²¡æœ‰ const**ï¼Œå› ä¸º mutable è¡¨ç¤ºæˆ‘ä»¬å…è®¸ä¿®æ”¹å‰¯æœ¬ã€‚



## ğŸ§  æ€è€ƒç»ƒä¹ ï¼ˆä½ å¯ä»¥å°è¯•å®ç°ï¼‰ï¼š


1. æ¨¡æ‹Ÿæ•è· `[=]` å’Œ `[&]` æ··åˆçš„æ›´å¤æ‚ç»“æ„ï¼›
2. æ¨¡æ‹Ÿä¸€ä¸ªæ³›å‹ Lambdaï¼Œæ¯”å¦‚ `[](auto x, auto y) { return x + y; }`ï¼›
3. ç»™ä½ å®ç°çš„ç±»åŠ ä¸Š `constexpr` æˆ– `noexcept` æ”¯æŒï¼›
4. ç»™ `MyLambda` æ·»åŠ  `clone()`ã€`equals()` ç­‰é«˜çº§èƒ½åŠ›ï¼Œåƒæ ‡å‡†å‡½æ•°å¯¹è±¡é‚£æ ·å¯å¤åˆ¶å¯æ¯”è¾ƒã€‚


## âœ… æ€»ç»“

æ‰‹åŠ¨å®ç° Lambda ç±»çš„è¿‡ç¨‹ï¼Œä½ å…¶å®åœ¨åšçš„æ˜¯ï¼š
- æ¨¡æ‹Ÿ **é—­åŒ…ï¼ˆClosureï¼‰ç»“æ„**ï¼›
- ç†è§£ **å€¼æ•è· vs å¼•ç”¨æ•è·çš„è¯­ä¹‰åŒºåˆ«**ï¼›
- å®è·µ **å‡½æ•°å¯¹è±¡ï¼ˆfunctorï¼‰æ¨¡å¼**ï¼›
- å­¦ä¼šåœ¨æ¨¡æ¿ã€å‡½æ•°æŒ‡é’ˆã€`std::function` ç­‰ä¹‹é—´åˆ‡æ¢ã€‚

# C++ Lambda é¢è¯•é¢˜é›†

ä¸‹é¢æ˜¯ä¸€ä¸ªç³»ç»ŸåŒ–çš„ **C++ Lambda é¢è¯•é¢˜é›†ï¼ˆå«è§£æ & éš¾åº¦åˆ†çº§ï¼‰**ï¼Œåˆ†ä¸º 4 ä¸ªé˜¶æ®µï¼š**åŸºç¡€è¯­æ³•** â†’ **STL åº”ç”¨** â†’ **åº•å±‚åŸç†** â†’ **é«˜çº§é™·é˜± & æ¨¡æ‹Ÿå®ç°**ã€‚

## ğŸ§© ç¬¬ä¸€éƒ¨åˆ†ï¼šåŸºç¡€è¯­æ³•ä¸è¡Œä¸ºï¼ˆéš¾åº¦ï¼šâ˜…â˜†â˜†ï¼‰

### âœ… **é¢˜ 1ï¼šå€¼æ•è· vs å¼•ç”¨æ•è·**

```cpp
int x = 10;
auto f = [x]() mutable { x += 5; std::cout << x; };
f();
std::cout << x;
```

- è¾“å‡ºæ˜¯ä»€ä¹ˆï¼Ÿ
- ä¸ºä»€ä¹ˆ `x` æ²¡æœ‰è¢«ä¿®æ”¹ï¼Ÿ

âœ”ï¸ ç­”æ¡ˆï¼šè¾“å‡º `15 10`ã€‚`[x]` æ˜¯å€¼æ•è·ï¼Œ`mutable` å…è®¸ä¿®æ”¹çš„æ˜¯å‰¯æœ¬ã€‚

### âœ… **é¢˜ 2ï¼šLambda è¿”å›ç±»å‹æ¨å¯¼**

```cpp
auto f = [](bool b) {
    if (b) return 1;
    else return 3.14;
};
```

- è¿™æ®µä»£ç æ˜¯å¦åˆæ³•ï¼Ÿ
- å¦‚æœä¸åˆæ³•ï¼Œæ€ä¹ˆä¿®å¤ï¼Ÿ

âŒ éæ³•ï¼šä¸¤ä¸ª `return` çš„ç±»å‹ä¸åŒã€‚
âœ”ï¸ ä¿®å¤æ–¹æ³•ä¸€ï¼šæ‰‹åŠ¨æŒ‡å®šè¿”å›ç±»å‹ï¼š

```cpp
auto f = [](bool b) -> double {
    if (b) return 1;
    else return 3.14;
};
```

### âœ… **é¢˜ 3ï¼šåˆå§‹åŒ–æ•è·ï¼ˆC++14ï¼‰**

```cpp
int x = 10;
auto f = [y = x + 5]() { std::cout << y; };
f();
```

- è¾“å‡ºä»€ä¹ˆï¼Ÿ
- åˆå§‹åŒ–æ•è·åœ¨ C++11 ä¸­åˆæ³•å—ï¼Ÿ

âœ”ï¸ è¾“å‡º `15`ï¼›åˆå§‹åŒ–æ•è·æ˜¯ **C++14 å¼•å…¥çš„æ–°ç‰¹æ€§**ã€‚


## ğŸ§© ç¬¬äºŒéƒ¨åˆ†ï¼šLambda ä¸ STL åº”ç”¨ï¼ˆéš¾åº¦ï¼šâ˜…â˜…â˜†ï¼‰

### âœ… **é¢˜ 4ï¼šstd::sort + Lambda æ’åº**

æŒ‰å­—ç¬¦ä¸²é•¿åº¦ä»çŸ­åˆ°é•¿æ’åºï¼š

```cpp
std::vector vec = {"apple", "kiwi", "banana"};
```

è¯·å†™å‡ºæ’åºè¯­å¥ã€‚

```cpp
std::sort(vec.begin(), vec.end(), [](const std::string& a, const std::string& b) {
    return a.size() < b.size();
});
```

### âœ… **é¢˜ 5ï¼šstd::copy_if + å¤–éƒ¨å˜é‡æ•è·**

```cpp
std::vector v = {3, 12, 5, 8, 20};
int threshold = 10;
std::vector filtered;

std::copy_if(v.begin(), v.end(), std::back_inserter(filtered), [threshold](int x) {
    return x &gt; threshold;
});
```

- æ•è· `threshold` æ˜¯å¦å¯ä»¥ç”¨ `[=]`ï¼Ÿ
- å¦‚æœä½¿ç”¨ `[&]` æœ‰ä½•é£é™©ï¼Ÿ

âœ”ï¸ `[=]` æ˜¯å€¼æ•è·ï¼Œå¯å®‰å…¨ä½¿ç”¨ï¼›
âš ï¸ `[&]` å¦‚æœ threshold æ˜¯å±€éƒ¨å˜é‡ï¼Œä¼šå¯¼è‡´æ‚¬ç©ºå¼•ç”¨é£é™©ã€‚

## ğŸ§© ç¬¬ä¸‰éƒ¨åˆ†ï¼šåº•å±‚åŸç†ç†è§£ï¼ˆéš¾åº¦ï¼šâ˜…â˜…â˜…ï¼‰

### âœ… **é¢˜ 6ï¼šè§£é‡Šè¿™ä¸ª Lambda æ˜¯å¦‚ä½•è¢«ç¼–è¯‘å™¨è½¬æ¢çš„ï¼Ÿ**

```cpp
int a = 10, b = 20;
auto f = [=, &b](int x) { return a + b + x; };
```

è¦æ±‚å†™å‡ºå…¶ç­‰ä»·çš„ç»“æ„ä½“ç±»ã€‚

```cpp
struct Lambda {
    int a;
    int& b;

    Lambda(int a_, int& b_) : a(a_), b(b_) {}

    int operator()(int x) const {
        return a + b + x;
    }
};

Lambda f(a, b);
```

### âœ… **é¢˜ 7ï¼šä¸ºä»€ä¹ˆæ— æ•è· Lambda èƒ½è½¬æ¢ä¸ºå‡½æ•°æŒ‡é’ˆï¼Ÿ**

```cpp
auto f = [](int x) { return x + 1; };
int (*fp)(int) = f;
```

- å¦‚æœæ”¹æˆ `[x]`, èƒ½è½¬æ¢å—ï¼Ÿ
- ä¸ºä»€ä¹ˆï¼Ÿ


âœ”ï¸ åŸå› ï¼šæ— æ•è· Lambda ç¼–è¯‘ä¸º `static` å‡½æ•°ï¼Œ**æ— çŠ¶æ€**ï¼Œæ‰€ä»¥å¯ä»¥é€€åŒ–ä¸ºå‡½æ•°æŒ‡é’ˆã€‚
âŒ æœ‰æ•è· Lambda æ˜¯ä¸€ä¸ª **æœ‰çŠ¶æ€ç±»å¯¹è±¡**ï¼Œä¸èƒ½é€€åŒ–ã€‚

### âœ… **é¢˜ 8ï¼šæ³›å‹ Lambda çš„ operator() æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ**

```cpp
auto f = [](auto x) { return x * x; };
```

- ç¼–è¯‘å™¨ä¸ºæ­¤ç”Ÿæˆäº†ä»€ä¹ˆï¼Ÿ
- è¿™å¯ä»¥ç†è§£ä¸ºä»€ä¹ˆç»“æ„ï¼Ÿ

âœ”ï¸ ç±»ä¼¼ï¼š

```cpp
struct Lambda {
    template
    auto operator()(T x) const { return x * x; }
};
```

## ğŸ§© ç¬¬å››éƒ¨åˆ†ï¼šé™·é˜±é¢˜ & å®ç°é¢˜ï¼ˆéš¾åº¦ï¼šâ˜…â˜…â˜…â˜…ï¼‰

### âœ… **é¢˜ 9ï¼šæ‚¬ç©ºå¼•ç”¨æ•è·**

```cpp
std::function f;

{
    int x = 42;
    f = [&x]() {
        std::cout << x << std::endl;
    };
}

f();  // å®‰å…¨å—ï¼Ÿ
```


âŒ å±é™©ï¼x ç”Ÿå‘½å‘¨æœŸå·²ç»ç»“æŸï¼Œå¼•ç”¨æ•è·å¯¼è‡´ **æ‚¬ç©ºå¼•ç”¨**ã€‚
### âœ… **é¢˜ 10ï¼šæ‰‹å†™æ¨¡æ‹Ÿ Lambda çš„ç±»**

æ¨¡æ‹Ÿè¿™ä¸ª Lambdaï¼š

```cpp
int a = 1, b = 2;
auto f = [a, &b](int x) { return a + b + x; };
```

æ¨¡æ‹Ÿå®ç°å¦‚ä¸‹ï¼š
```cpp
struct MyLambda {
    int a;
    int& b;

    MyLambda(int a_, int& b_) : a(a_), b(b_) {}

    int operator()(int x) const {
        return a + b + x;
    }
};
```